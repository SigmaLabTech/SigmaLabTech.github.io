<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Coding AI</title>
  <style>
 /* Reset some default styles */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

/* Styling for the body */
body {
  font-family: 'Roboto', sans-serif; /* Change to match the previous design */
  background-color: #0E0E16; /* Dark background */
  color: #EAEAEA; /* Light text for readability */
  margin: 0;
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
  font-size: 1.5rem; /* Base font size */
}

/* Chat container styles */
.chatcontainer {
  width: 100%; /* Wider container */
  max-width: 1000px; /* Set a maximum width */
  height: 90vh; /* Adjusted height for the chat container */
  max-height: 90vh; /* Set maximum height to 90% of viewport height */
  background-color: #1F1F2E; /* Dark background */
  border: 1px solid #4B9CD3; /* Border color matching the theme */
  border-radius: 10px;
  overflow: auto; /* Enable scrollbars when content overflows */
  display: flex;
  flex-direction: column; /* Arrange children vertically */

}

/* Chat display styles */
.chatdisplay {
  flex: 1; /* Allow the chat display to grow to fill available space */
  overflow-y: auto;
  margin-bottom: 10px;
  padding: 10px;
  background-color: #2A2A39; /* Slightly lighter dark background */
  color: #EAEAEA; /* Light text color */
}

/* Input and button styles */
.input-container {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 10px;
  background-color: #1F1F2E; /* Match chat container */
}

input[type="text"],
.send-button {
  width: calc(50% - 5px); /* Adjusted width for the input field and send button */
  padding: 10px;
  border: 1px solid #4B9CD3; /* Border color matching the theme */
  border-radius: 5px;
  background-color: #2A2A39; /* Dark background */
  color: #EAEAEA; /* Light text */
  font-size: 1em; /* Base font size */
  outline: none;
}

input[type="text"]::placeholder {
  font-size: 1em;
  color: #A9A9A9; /* Grey placeholder text color */
}

.send-button {
  background-color: #4B9CD3; /* Button color */
  color: white; /* Button text color */
  font-size: 1em; /* Base font size */
  border: none; /* No border for the button */
  padding: 10px 15px;
  cursor: pointer;
  border-radius: 5px;
  transition: background-color 0.3s ease;
}

.send-button:hover {
  background-color: #357B9C; /* Darker button color on hover */
}

/* Message styles */
.message {
  margin-bottom: 10px;
}

/* Style user messages */
.user-message {
  color: #EAEAEA; /* Light color for user messages */
}

/* Style assistant messages */
.assistant-message {
  color: #4B9CD3; /* Color for assistant messages */
}

/* Typing indicator styles */
.typing::before {
  content: "AI is thinking...";
  color: #4B9CD3; /* Color for typing indicator */
  display: block;
}

/* Code snippet styles */
pre.code {
  white-space: pre-wrap;
  word-break: break-all;
  background-color: #2A2A39; /* Dark background for code */
  color: #EAEAEA; /* Light color for code text */
  border: 1px solid #4B9CD3; /* Border matching the theme */
  padding: 10px;
  border-radius: 5px;
  font-family: 'Courier New', Courier, monospace;
  overflow-x: auto;
}

/* Media queries for responsive design */
@media (max-width: 768px) {
  body {
    font-size: 1em;
  }
  .chatcontainer {
    width: 90%; /* Adjust the width for smaller screens */
  }
}

@media (max-width: 480px) {
  body {
    font-size: 1em;
  }
  .chatcontainer {
    width: 95%; /* Further adjust the width for mobile screens */
  }

  .input-container {
    flex-direction: column; /* Stack input and button vertically */
    align-items: stretch; /* Stretch input to full width */
  }

  input[type="text"],
  .send-button {
    width: 100%; /* Full width for input field and send button */
    margin-bottom: 10px; /* Add some spacing between input and button */
  }
}
</style>

</head>

<body>
  <div class="chatcontainer">
    <div id="chatContainer" class="chatdisplay">
      <div class="assistant-message">
        Hello! I am a Developer AI. Ask me anything.
      </div>
    </div>
    <div class="input-container">
      <input type="text" id="userInput" placeholder="Type your message...">
      <button class="send-button" id="sendMessageButton">Send</button>
    </div>
  </div> 
  <!-- Move your JavaScript code to the end of the body -->
 <script>
    document.addEventListener("DOMContentLoaded", function () {
      const apiKey = "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";
      const endpointUrl = "https://api.openai.com/v1/chat/completions";
      const modelName = "gpt-4";

      const chatContainer = document.getElementById("chatContainer");
      const userInput = document.getElementById("userInput");
      const sendMessageButton = document.getElementById("sendMessageButton");

      // Initialize the conversation array with a welcome message from AI
      let conversation = [
        {
          role: "system",
          content: "I'm an AI developed to assist with computer programming, coding, data science and more."
        },
        
       
        // Other messages with user and assistant roles
      ];

      // Load previous conversation when the page loads
      loadConversation();

      sendMessageButton.addEventListener("click", sendMessage);

      userInput.addEventListener("keyup", function (event) {
        if (event.key === "Enter") {
          sendMessage();
        }
      });

      function addUserMessage(message) {
        const userMessage = document.createElement("div");
        userMessage.className = "message";
        userMessage.innerHTML = `<div class="user-message">You: ${message}</div>`;
        chatContainer.appendChild(userMessage);
      }

      function addAssistantMessage(message) {
        const assistantMessage = document.createElement("div");
        assistantMessage.className = "message";

        if (isCodeSnippet(message)) {
          assistantMessage.innerHTML = `<div class="assistant-message"><pre class="code">${escapeHTML(message)}</pre></div>`;
        } else {
          assistantMessage.innerHTML = `<div class="assistant-message">${message}</div>`;
        }

        chatContainer.appendChild(assistantMessage);
      }

      function escapeHTML(html) {
        var text = document.createTextNode(html);
        var p = document.createElement('p');
        p.appendChild(text);
        return p.innerHTML;
      }

       async function sendMessage() {
  const userMessage = userInput.value.trim();
  if (userMessage === "") return;

  addUserMessage(userMessage);
  userInput.value = "";

  addAssistantMessage('<span class="typing"></span>');

  try {
    let assistantResponse;
    const response = await fetchOpenAiResponse(userMessage);
    assistantResponse = response.choices[0].message.content;

    if (isCodeSnippet(assistantResponse)) {
      addCodeSnippet(assistantResponse, detectLanguage(assistantResponse));
    } else {
      removeTypingIndicator(); // Remove the typing indicator
      addAssistantMessage(assistantResponse);
    }

    conversation.push({ role: "user", content: userMessage });
    conversation.push({ role: "assistant", content: assistantResponse });
    storeConversation(conversation);
  } catch (error) {
    console.error("An error occurred:", error);
    removeTypingIndicator(); // Remove the typing indicator
    addAssistantMessage("Could you tell me more about that?");
  }
}

      function removeTypingIndicator() {
        const typingIndicator = chatContainer.querySelector('.typing');
        if (typingIndicator) {
          typingIndicator.remove();
        }
      }

      async function fetchOpenAiResponse(message) {
        const response = await fetch(endpointUrl, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${apiKey}`
          },
          body: JSON.stringify({
            messages: conversation.concat([
              {
                role: "user",
                content: message
              }
            ]),
            model: modelName
          })
        });

        return await response.json();
      }

      function isCodeSnippet(message) {
        // Simplified logic for demonstration; expand as needed
        return message.includes("<!DOCTYPE html>") || message.includes("def ") || message.includes("function ");
      }

      function detectLanguage(codeSnippet) {
        // Simple language detection logic for demonstration
        if (codeSnippet.includes("<!DOCTYPE html>")) return "html";
        if (codeSnippet.includes("def ")) return "python";
        if (codeSnippet.includes("function ")) return "javascript";
        return ""; // Default case
      }

      function addCodeSnippet(code, language) {
        const codeSnippet = document.createElement("div");
        codeSnippet.className = "message";
        codeSnippet.innerHTML = `<div class="assistant-message"><pre class="code ${language}">${escapeHTML(code)}</pre></div>`;
        chatContainer.appendChild(codeSnippet);
        removeTypingIndicator(); // Remove the typing indicator
      }

function scrollToBottom() {
  // Scroll to the bottom of the chat display
  chatContainer.scrollTop = chatContainer.scrollHeight;
}

function addUserMessage(message) {
  const userMessage = document.createElement("div");
  userMessage.className = "message";
  userMessage.innerHTML = `<div class="user-message">You: ${message}</div>`;
  chatContainer.appendChild(userMessage);
  scrollToBottom(); // Scroll to bottom after adding a new message
}

function addAssistantMessage(message) {
  const assistantMessage = document.createElement("div");
  assistantMessage.className = "message";

  if (isCodeSnippet(message)) {
    assistantMessage.innerHTML = `<div class="assistant-message"><pre class="code">${escapeHTML(message)}</pre></div>`;
  } else {
    assistantMessage.innerHTML = `<div class="assistant-message">${message}</div>`;
  }

  chatContainer.appendChild(assistantMessage);
  scrollToBottom(); // Scroll to bottom after adding a new message
}



// Function to scroll to the bottom of the chat display when window is resized
window.addEventListener('resize', function() {
  scrollToBottom();
});



      function storeConversation(conversation) {
        localStorage.setItem("conversation", JSON.stringify(conversation));
      }

      function getStoredConversation() {
        const storedConversation = localStorage.getItem("conversation");
        return storedConversation ? JSON.parse(storedConversation) : null;
      }

      function loadConversation() {
        // Load the conversation history when the page loads
        conversation.forEach((message) => {
          if (message.role === "user") {
            addUserMessage(message.content);
          } else if (message.role === "assistant") {
            addAssistantMessage(message.content);
          }
        });
      }

      // Function to clear the conversation
      function clearConversation() {
        conversation = []; // Reset the conversation array
        chatContainer.innerHTML = ''; // Clear the chat display
        storeConversation(conversation); // Store the cleared conversation
      }

      // Add an event listener to clear the conversation when the user exits
      window.addEventListener("beforeunload", function (e) {
        clearConversation();
        e.preventDefault();
        e.returnValue = '';
      });
    });
  </script>
</body>
</html>
